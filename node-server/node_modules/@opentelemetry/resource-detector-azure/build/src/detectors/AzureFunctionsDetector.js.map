{"version":3,"file":"AzureFunctionsDetector.js","sourceRoot":"","sources":["../../../src/detectors/AzureFunctionsDetector.ts"],"names":[],"mappings":";AAAA;;;;;;;;;;;;;;GAcG;;;AAEH,wDAA6E;AAE7E,8EAI6C;AAC7C,oCAMkB;AAElB,MAAM,kCAAkC,GAAG;IACzC,CAAC,iDAA0B,CAAC,SAAS,CAAC,EAAE,yBAAiB;IACzD,CAAC,iDAA0B,CAAC,YAAY,CAAC,EAAE,yBAAiB;IAC5D,CAAC,iDAA0B,CAAC,aAAa,CAAC,EAAE,2BAAmB;IAC/D,CAAC,iDAA0B,CAAC,eAAe,CAAC,EAAE,2BAAmB;CAClE,CAAC;AAEF;;;GAGG;AACH,MAAM,sBAAsB;IAC1B,MAAM;QACJ,IAAI,UAAU,GAAG,EAAE,CAAC;QACpB,MAAM,YAAY,GAAG,OAAO,CAAC,GAAG,CAAC,yBAAiB,CAAC,CAAC;QACpD,MAAM,eAAe,GAAG,OAAO,CAAC,GAAG,CAAC,yBAAiB,CAAC,CAAC;QACvD,IAAI,YAAY,IAAI,eAAe,EAAE;YACnC,MAAM,gBAAgB,GAAG,OAAO,CAAC,GAAG,CAAC,2BAAmB,CAAC,CAAC;YAC1D,MAAM,gBAAgB,GAAG,OAAO,CAAC,GAAG,CAAC,2BAAmB,CAAC,CAAC;YAE1D,UAAU,GAAG;gBACX,CAAC,iDAA0B,CAAC,cAAc,CAAC,EAAE,0CAAmB,CAAC,KAAK;gBACtE,CAAC,iDAA0B,CAAC,cAAc,CAAC,EACzC,0CAAmB,CAAC,eAAe;gBACrC,CAAC,iDAA0B,CAAC,YAAY,CAAC,EAAE,OAAO,CAAC,GAAG,CAAC,mBAAW,CAAC;aACpE,CAAC;YAEF,IAAI,YAAY,EAAE;gBAChB,UAAU,mCACL,UAAU,KACb,CAAC,iDAA0B,CAAC,SAAS,CAAC,EAAE,YAAY,GACrD,CAAC;aACH;YACD,IAAI,eAAe,EAAE;gBACnB,UAAU,mCACL,UAAU,KACb,CAAC,iDAA0B,CAAC,YAAY,CAAC,EAAE,eAAe,GAC3D,CAAC;aACH;YACD,IAAI,gBAAgB,EAAE;gBACpB,UAAU,mCACL,UAAU,KACb,CAAC,iDAA0B,CAAC,aAAa,CAAC,EAAE,gBAAgB,GAC7D,CAAC;aACH;YACD,IAAI,gBAAgB,EAAE;gBACpB,UAAU,mCACL,UAAU,KACb,CAAC,iDAA0B,CAAC,eAAe,CAAC,EAAE,gBAAgB,GAC/D,CAAC;aACH;YAED,KAAK,MAAM,CAAC,GAAG,EAAE,KAAK,CAAC,IAAI,MAAM,CAAC,OAAO,CACvC,kCAAkC,CACnC,EAAE;gBACD,MAAM,MAAM,GAAG,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;gBAClC,IAAI,MAAM,EAAE;oBACV,UAAU,mCAAQ,UAAU,GAAK,EAAE,CAAC,GAAG,CAAC,EAAE,MAAM,EAAE,CAAE,CAAC;iBACtD;aACF;SACF;QACD,OAAO,IAAI,oBAAQ,CAAC,UAAU,CAAC,CAAC;IAClC,CAAC;CACF;AAEY,QAAA,sBAAsB,GAAG,IAAI,sBAAsB,EAAE,CAAC","sourcesContent":["/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { DetectorSync, IResource, Resource } from '@opentelemetry/resources';\n\nimport {\n  CloudProviderValues,\n  CloudPlatformValues,\n  SemanticResourceAttributes,\n} from '@opentelemetry/semantic-conventions';\nimport {\n  WEBSITE_SITE_NAME,\n  FUNCTIONS_VERSION,\n  WEBSITE_INSTANCE_ID,\n  FUNCTIONS_MEM_LIMIT,\n  REGION_NAME,\n} from '../types';\n\nconst AZURE_FUNCTIONS_ATTRIBUTE_ENV_VARS = {\n  [SemanticResourceAttributes.FAAS_NAME]: WEBSITE_SITE_NAME,\n  [SemanticResourceAttributes.FAAS_VERSION]: FUNCTIONS_VERSION,\n  [SemanticResourceAttributes.FAAS_INSTANCE]: WEBSITE_INSTANCE_ID,\n  [SemanticResourceAttributes.FAAS_MAX_MEMORY]: FUNCTIONS_MEM_LIMIT,\n};\n\n/**\n * The AzureFunctionsDetector can be used to detect if a process is running in Azure Functions\n * @returns a {@link Resource} populated with data about the environment or an empty Resource if detection fails.\n */\nclass AzureFunctionsDetector implements DetectorSync {\n  detect(): IResource {\n    let attributes = {};\n    const functionName = process.env[WEBSITE_SITE_NAME];\n    const functionVersion = process.env[FUNCTIONS_VERSION];\n    if (functionName && functionVersion) {\n      const functionInstance = process.env[WEBSITE_INSTANCE_ID];\n      const functionMemLimit = process.env[FUNCTIONS_MEM_LIMIT];\n\n      attributes = {\n        [SemanticResourceAttributes.CLOUD_PROVIDER]: CloudProviderValues.AZURE,\n        [SemanticResourceAttributes.CLOUD_PLATFORM]:\n          CloudPlatformValues.AZURE_FUNCTIONS,\n        [SemanticResourceAttributes.CLOUD_REGION]: process.env[REGION_NAME],\n      };\n\n      if (functionName) {\n        attributes = {\n          ...attributes,\n          [SemanticResourceAttributes.FAAS_NAME]: functionName,\n        };\n      }\n      if (functionVersion) {\n        attributes = {\n          ...attributes,\n          [SemanticResourceAttributes.FAAS_VERSION]: functionVersion,\n        };\n      }\n      if (functionInstance) {\n        attributes = {\n          ...attributes,\n          [SemanticResourceAttributes.FAAS_INSTANCE]: functionInstance,\n        };\n      }\n      if (functionMemLimit) {\n        attributes = {\n          ...attributes,\n          [SemanticResourceAttributes.FAAS_MAX_MEMORY]: functionMemLimit,\n        };\n      }\n\n      for (const [key, value] of Object.entries(\n        AZURE_FUNCTIONS_ATTRIBUTE_ENV_VARS\n      )) {\n        const envVar = process.env[value];\n        if (envVar) {\n          attributes = { ...attributes, ...{ [key]: envVar } };\n        }\n      }\n    }\n    return new Resource(attributes);\n  }\n}\n\nexport const azureFunctionsDetector = new AzureFunctionsDetector();\n"]}